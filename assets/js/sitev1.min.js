$(document).ready(function(){function r(){y.scale(1);y.translate([0,0]);m.transition().duration(1e3).attr("transform","translate(0,0)scale(1)");m.selectAll("path").attr("d",path.projection(projection))}function s(){t.innerHTML="";$("#map").attr("class","");d3.selectAll(".points").remove();d3.selectAll(".regional-points").remove();$("#trends-switch").removeClass("active");$(".onoffswitch-checkbox").prop("checked",false);$(".switch").removeClass("active");$(".switch.national").addClass("active");$(".country-label").attr("class","country-label");d3.selectAll(".country-labels").moveToBack();$(".country").attr("class","country");$(".country").attr("style","");$("#partners-back").removeClass("active");$("#dock-container, .dock-nav").css("bottom","-60px");$(".world").attr("class","world");$("#data-notes-button, #reset").removeClass("partners")}function o(){t.innerHTML="";$("body").addClass("intro");$("#info").css("left","-25%");$(".view").css("top","-100px");$("#intro").fadeIn(400);$(".view").removeClass("current");$("#bsm").attr("class","")}function g(e,t,n,r){m.selectAll("world").data(topojson.feature(r,r.objects.world).features).enter().append("path").attr("class","world").attr("d",path);m.selectAll("land").data(topojson.feature(n,n.objects.land).features).enter().append("path").attr("class","land").attr("d",path);var i;var s=m.selectAll("country").data(topojson.feature(t,t.objects.countries).features).enter().append("path").attr("class","country").attr("id",function(e){return e.properties.gu_a3}).attr("d",path).on("mouseover",function(e){if($("#map").hasClass("partners")){var t=$("#"+e.properties.gu_a3+"-label");i=t.attr("class");t.attr("class","country-label active")}}).on("mouseout",function(e){var t=$("#"+e.properties.gu_a3+"-label");t.attr("class",i)});var o=m.selectAll(".country-label").data(topojson.feature(t,t.objects.countries).features).enter().append("text").attr("class","country-label").attr("id",function(e){return e.properties.gu_a3+"-label"}).attr("transform",function(e){if(e.properties.admin=="Nicaragua"||e.properties.admin=="Honduras"){var t=[path.centroid(e)[0]+32,path.centroid(e)[1]]}else if(e.properties.admin=="El Salvador"){var t=[path.centroid(e)[0]-35,path.centroid(e)[1]+4]}else if(e.properties.admin=="Ivory Coast"){var t=[path.centroid(e)[0],path.centroid(e)[1]+20]}else if(e.properties.admin=="Uganda"){var t=[path.centroid(e)[0],path.centroid(e)[1]-20]}else if(e.properties.admin=="Indonesia"){var t=[path.centroid(e)[0],path.centroid(e)[1]+16]}else if(e.properties.admin=="India"){var t=[path.centroid(e)[0],path.centroid(e)[1]+6]}else if(e.properties.admin=="Dominican Republic"){var t=[path.centroid(e)[0]+55,path.centroid(e)[1]]}else if(e.properties.admin=="Laos"){var t=[path.centroid(e)[0],path.centroid(e)[1]-20]}else if(e.properties.admin=="Vietnam"){var t=[path.centroid(e)[0]+20,path.centroid(e)[1]-10]}else if(e.properties.admin=="Nigeria"){var t=[path.centroid(e)[0]+14,path.centroid(e)[1]-5]}else if(e.properties.admin=="Burundi"){var t=[path.centroid(e)[0],path.centroid(e)[1]-7]}else{var t=[path.centroid(e)[0],path.centroid(e)[1]-10]}return"translate("+t+")"}).attr("dy",".35em").text(function(e){return e.properties.admin})}function b(){t.innerHTML='<div class="contain"><h2 class="info-title">Fortune 500 companies that partner with USAID on global health</h2>                  <p class="desc">Click on a logo at the bottom of the map to see which US Fortune 500 companies have global health partnerships with USAID.</p>                  <p class="desc">Or, explore the Top 5 companies with the most partnerships.</p>                  <h4 class="partners info-list-title"><span>Greatest Number of Partnerships</span></h4>                  <ol class="info-list partners-list">                    <li data-target="c35" id="c35"><span class="info-list-item">The Coca-Cola Company</span> <span class="national-trends-projects"><span class="i">&#128278;</span>28</span></li>                    <li data-target="c12" id="c12"><span class="info-list-item">ExxonMobil</span> <span class="national-trends-projects"><span class="i">&#128278;</span>13</span></li>                    <li data-target="c29" id="c29"><span class="info-list-item">Pfizer</span> <span class="national-trends-projects"><span class="i">&#128278;</span>12</span></li>                    <li data-target="c19" id="c19"><span class="info-list-item">Johnson & Johnson</span> <span class="national-trends-projects"><span class="i">&#128278;</span>10</span></li>                    <li data-target="c30" id="c30"><span class="info-list-item">Proctor & Gamble</span> <span class="national-trends-projects"><span class="i">&#128278;</span>9</span></li>                  </ol>                  </div>';t.innerHTML+=""}function w(){$(".world").attr("class","world");$(".country").attr("style","");$(".country").attr("class","country");$(".country-label").attr("class","country-label")}function E(e,n){w();$("#partners-back").addClass("active");for(e=0;e<companies.length;e++){var r=companies[e]["corpid"];if(n===r){for(var i=0;i<companies[e]["countries"].length;i++){var s=companies[e]["countries"][i];if(s!="LAC (Continent)"&&s!="global"){$("#"+s).attr("style","fill:"+companies[e]["hex"]);$("#"+s+"-label").attr("class","country-label active")}}t.innerHTML="";t.innerHTML='<img class="corp-logo contain" src="assets/logos/'+companies[e].logo+'">';t.innerHTML+='<h2 class="corp-name">'+companies[e].company+"</h2>";if(companies[e].foundation){t.innerHTML+='<h3 class="corp-foundation">Includes '+companies[e].foundation+"</h3>"}t.innerHTML+='<p class="corp-project-count">Partnerships: <strong>'+companies[e].projects.length+"</strong></p>";projectList=document.createElement("ol");projectList.id="projects";t.appendChild(projectList);var o=false;for(var u=0;u<companies[e].projects.length;u++){for(var a=0;a<projects.length;a++){if(projects[a].projID===companies[e].projects[u]){var f=projects[a];projectItem=document.createElement("li");projectItem.className="project";projectItem.id=f.projID;var l=document.createElement("div");l.className="project-title";l.innerHTML=f.projName;for(var c=0;c<projects[a].projCountries.length;c++){if(projects[a].projCountries[c]=="Global"||projects[a].projCountries[c]=="global"){o=!o;l.className="project-title global"}}l.style.borderLeftColor="#"+companies[e].hex;projectItem.appendChild(l);var h=f.projDescNew.length>0?f.projDescNew:f.projDesc;var p=f.yearEnd!="nodata"?f.yearStart+"-"+f.yearEnd:"Started in "+f.yearStart;var d="US Gov: <strong>"+f.usgI+"</strong>, Non-US Gov: <strong>"+f.nusgI+"</strong>";projectItem.innerHTML+='<div class="project-info"><p class="project-years">'+p+'</p><p class="project-capitol">'+d+"</p>"+h+"</div>";projectList.appendChild(projectItem)}}}if(o){t.innerHTML+='<p class="info-note contain">Projects marked with <span class="i">&#127758;</span> are global, not attributed to a specific country or region.</p>'}}}}function S(){$(".world").attr("class","world active");d3.selectAll(".world").moveToFront()}function x(){$(".world").attr("class","world");d3.selectAll(".world").moveToBack()}function T(){t.innerHTML="";t.innerHTML+='<div class="national-trends-info trend-info contain active">                    <h2 class="info-title">Partnership trends by country</h2>                    <p class="desc">USAIDâ€™s public-private partnerships in global health and water sanitation are distributed across 76 countries. Explore the map to learn which countries have the most partnerships and which countries have received the greatest amount of funding.<br><span class="info-note"><span class="i r">&#128100;</span>signifies "per capita" calculations.</span></p>                    <h4 class="national-trends-list-title">Top 5 Countries By<br><span>Total Investment</span></h4>                    <ol class="national-trends-list">                    <li data-country="india" data-projects="32" data-symbol="India" class="t-india"><span class="national-trends-country">India</span> <span class="national-trends-total">$257.9<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$0.21</span></li>                    <li data-country="southafrica" data-projects="50" data-symbol="SouthAfrica" class="t-southafrica"><span class="national-trends-country">South Africa</span> <span class="national-trends-total">$146.1<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$2.76</span></li>                    <li data-country="tanzania" data-projects="17" data-symbol="UnitedRepublicofTanzania" class="t-tanzania"><span class="national-trends-country">Tanzania</span> <span class="national-trends-total">$142.1<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$2.89</span></li>                    <li data-country="guatemala" data-projects="8" data-symbol="Guatemala" class="t-guatemala"><span class="national-trends-country">Guatemala</span> <span class="national-trends-total">$142.1<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$9.19</span></li>                    <li data-country="zimbabwe" data-projects="4" data-symbol="Zimbabwe" class="t-zimbabwe"><span class="national-trends-country">Zimbabwe</span> <span class="national-trends-total">$81.9<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$5.79</span></li>                    </ol>                    <h4 class="national-trends-list-title">Top 5 Countries By<br><span>US Government Investment</span></h4>                    <ol class="national-trends-list">                    <li data-country="india" data-projects="32" data-symbol="India" class="t-india"><span class="national-trends-country">India</span> <span class="national-trends-total">$171.6<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$0.14</span></li>                    <li data-country="tanzania" data-projects="17" data-symbol="UnitedRepublicofTanzania" class="t-tanzania"><span class="national-trends-country">Tanzania</span> <span class="national-trends-total">$68.6<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$1.39</span></li>                    <li data-country="bangladesh" data-projects="9" data-symbol="Bangladesh" class="t-bangladesh"><span class="national-trends-country">Bangladesh</span> <span class="national-trends-total">$59<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$0.38</span></li>                    <li data-country="angola" data-projects="7" data-symbol="Angola" class="t-angola"><span class="national-trends-country">Angola</span> <span class="national-trends-total">$50.4<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$2.34</span></li>                    <li data-country="guatemala" data-projects="8" data-symbol="Guatemala" class="t-guatemala"><span class="national-trends-country">Guatemala</span> <span class="national-trends-total">$48<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$3.10</span></li>                    </ol>                    <h4 class="national-trends-list-title">Top 5 Countries By<br><span>Non-US Government Investment</span></h4>                    <ol class="national-trends-list">                    <li data-country="southafrica" data-projects="50" data-symbol="SouthAfrica" class="t-southafrica"><span class="national-trends-country">South Africa</span> <span class="national-trends-total">$103<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$1.94</span></li>                    <li data-country="guatemala" data-projects="8" data-symbol="Guatemala" class="t-guatemala"><span class="national-trends-country">Guatemala</span> <span class="national-trends-total">$85.7<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$6.08</span></li>                    <li data-country="india" data-projects="32" data-symbol="India" class="t-india"><span class="national-trends-country">India</span> <span class="national-trends-total">$73.5<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$0.07</span></li>                    <li data-country="tanzania" data-projects="17" data-symbol="UnitedRepublicofTanzania" class="t-tanzania"><span class="national-trends-country">Tanzania</span> <span class="national-trends-total">$25.7<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$1.49</span></li>                    <li data-country="russia" data-projects="8" data-symbol="Russia" class="t-russia"><span class="national-trends-country">Russia</span> <span class="national-trends-total">$21.4<small>M</small></span> <span class="national-trends-capita"><span class="i">&#128100;</span>$0.41</span></li>                    </ol>                    </div>';t.innerHTML+='<div class="regional-trends-info trend-info contain">                    <h2 class="info-title">Partnership trends by region</h2>                    <p class="desc">Explore the map to see the regional breakdown of partnerships and funding across USAIDâ€™s public-private partnerships in the global health and water sanitation sectors. </p>                    <h4 class="info-list-title regional-trends">Total Investment Per Region</h4>                    <svg id="chart"></svg>                    <p class="info-note">* global refers to partnerships that operate across regions</p>                    </div>'}function N(){d3.json("../data/points_v2.json",function(e,t){svg.select("g").selectAll(".points").data(topojson.feature(t,t.objects.ppp_points).features).enter().append("path").attr("class","points").attr("d",path.pointRadius(function(e){var t=+e.properties.numProj;return a(t)})).attr("id",function(e){return e.properties.admin.replace(/ /g,"")}).on("mouseover",function(e){var t=e.properties.admin.replace(/ /g,"");var n="t-"+t.toLowerCase();if(document.getElementsByClassName(n).length>0){$(".national-trends-list li."+n).addClass("highlight")}var r=k(t);d3.select("#trend-tip").style("left",r.left+"px").style("bottom",r.bottom+"px").classed("hidden",false).select("#tip-inner").html('<p class="tip-title">'+e.properties.admin+'</p><p class="tip-notes">Partnerships: <strong>'+e.properties.numProj+"</strong></p>")}).on("mouseout",function(e){$(".national-trends-list li").removeClass("highlight");d3.select("#trend-tip").classed("hidden",true)});d3.select("#Lesotho").moveToFront();d3.select("#Swaziland").moveToFront();d3.select("#Botswana").moveToFront()})}function C(e){d3.json("../data/regions_v3.json",function(t,n){svg.select("g").selectAll(".regional-points").data(topojson.feature(n,n.objects["regional-points"]).features).enter().append("path").attr("class","regional-points").attr("id",function(e){return e.properties.Region.replace("/","")}).attr("d",path.pointRadius(function(t){switch(e){case"Partnerships":var n=t.properties.Partnerships;return a(n);break;case"TLI":return f(A(t.properties.TLI));break;case"USG":return l(A(t.properties.USG));break;case"nonUSG":return h(A(t.properties.nonUSG));break;console.log("broken!")}console.log(n)})).on("mouseover",function(e){console.log(e);var t=e.properties.Region;var n=k(e.properties.Region.replace("/",""));var r=e.properties.fullName?e.properties.fullName:"";var i=parseInt(A(e.properties.USG));var s=parseInt(A(e.properties.nonUSG));var o=i+s;console.log(i,s,o);var u=e.properties.USG=="No Data"?"":'<p class="usgnusg-labels cf"><span class="usg-label">US GOV <span class="regional-percent">'+Math.round(i/o*100)+'%</span></span><span class="nusg-label"><span class="regional-percent">'+Math.round(s/o*100)+'%</span> NON-US GOV</span></p><div class="region-popup-bar"><div class="bar-right" style="width:'+s/o*100+'%"><span>'+e.properties.nonUSG+'</span></div><div class="bar-left" style="width:'+i/o*100+'%"><span>'+e.properties.USG+"</span></div></div>";d3.select("#trend-tip").style("left",function(e){console.log(n);if(t=="Asia"){return n.left-200+"px"}else{return n.left+"px"}}).style("bottom",n.bottom+"px").classed("hidden",false).classed("right",function(e){if(t=="Asia"){return true}else{return false}}).select("#tip-inner").html('<p class="tip-title">'+e.properties.Region+'</p><p class="tip-regional-fullname">'+r+'</p><p class="tip-regional-data tip-projects">Partnerships: <strong>'+e.properties.Partnerships+"</strong></p><hr>"+u+'<p class="tip-regional-data tip-usg">US GOV: <strong>'+e.properties.USG+'</strong></p><p class="tip-regional-data tip-nusg">NON-US GOV: <strong>'+e.properties.nonUSG+"</strong></p>");d3.select("#bar-"+e.properties.Region.replace("/","")).classed("active",true)}).on("mouseout",function(e){d3.select("#trend-tip").classed("hidden",true);d3.select("#bar-"+e.properties.Region.replace("/","")).classed("active",false)})})}function k(e){var t,n=document.getElementById(e).getBoundingClientRect();left=n.left+(n.width/2-20);bottom=$(window).outerHeight()-(n.top-15);t={left:left,bottom:bottom};return t}function L(){if(document.getElementsByClassName("points").length>0){svg.select("g").selectAll(".points").transition().duration(500).attr("style","stroke-opacity:0").remove();$(".regional-trends-button").removeClass("active");$("#Partnerships").addClass("active")}else{svg.select("g").selectAll(".regional-points").transition().duration(500).attr("style","stroke-opacity:0").remove()}}function A(e){e=e+"";e=e.replace("$","").replace(/\,/g,"");return e}function O(){var e=300,t=20;var n=d3.scale.linear().range([0,e]);var r=d3.select("#chart").attr("width",e);r.attr("height",t*regionalData.length);var i=0;for(var s=0;s<regionalData.length;s++){i=i+ +A(regionalData[s].TLI)}var o=r.selectAll("g").data(regionalData).enter().append("g").attr("id",function(e){return"bar-"+e.Region.replace("/","")}).attr("class","bar").attr("transform",function(e,n){return"translate(50,"+n*t+")"}).on("mouseover",function(e){d3.select("#"+e.Region.replace("/","")).classed("active",true);var t=k(e.Region.replace("/",""));var n=e.fullName?e.fullName:"";d3.select("#trend-tip").style("left",t.left+"px").style("bottom",t.bottom+"px").classed("hidden",false).select("#tip-inner").html('<p class="tip-title">'+e.Region+'</p><p class="tip-regional-fullname">'+n+'</p><p class="tip-regional-data tip-usg">US GOV: <strong>'+e.USG+'</strong></p><p class="tip-regional-data tip-nusg">NON-US GOV: <strong>'+e.nonUSG+'</strong></p><p class="tip-regional-data tip-projects">Partnerships: <strong>'+e.Partnerships+"</strong></p>")}).on("mouseout",function(e){d3.select("#"+e.Region.replace("/","")).classed("active",false);d3.select("#trend-tip").classed("hidden",true)});o.append("rect").attr("class","chart-rect").attr("width",function(t){return+A(t.TLI)/i*e+1}).attr("height",t-1);o.append("text").attr("x",function(t){if(t.Region==="Global/Multilateral"){return+A(t.TLI)/i*e-55}else{return+A(t.TLI)/i*e+5}}).attr("y",t/3).attr("class",function(e){if(e.Region==="Global/Multilateral"){return"chart-number white"}else{return"chart-number"}}).attr("dy","8px").text(function(e){return e.TLIshort+" M"});o.append("text").attr("text-anchor","end").attr("x",-3).attr("y",t/3).attr("class","chart-region").attr("dy","8px").text(function(e){if(e.Region==="Global/Multilateral"){return"Global*"}else if(e.Region==="Europe/Eurasia"){return"Eurasia"}else{return e.Region}})}function M(e){t.innerHTML="";for(var n=0;n<e.length;n++){d3.select("#"+e[n].country).moveToFront();var r=document.createElement("div");r.id="story-"+e[n].country;r.className="story";if(n==0){r.className+=" active"}r.innerHTML='<img src="'+e[n].imagePath+'">';r.innerHTML+='<div class="contain"><h2 class="info-title">'+e[n].title+'</h2>                          <p class="desc">'+e[n].info+'</p>                          <a class="story-readmore" target="_blank" href="'+e[n].link+'">Full Story</a></div>';t.appendChild(r);d3.select("#TZA").attr("class","country country-story active-country");d3.select("#"+e[n].country).attr("class","country country-story");d3.selectAll(".country-story").append("text").attr("text-anchor","middle").attr("font-family","entypo").attr("x",50).attr("y",50).attr("class","country-story-icon").attr("dy","8px").text("&#59172;")}}var e=document.getElementById("corporate-dock");var t=document.getElementById("info");var n=document.getElementById("map");$(".view").on("click",function(){if(!$(this).hasClass("current")){$("#bsm").attr("class","active");$(".view").removeClass("current");$(this).addClass("current");s();if($(this).attr("id")==="partners"){$("#map").addClass("partners");$("#data-notes-button, #reset, #bsm").addClass("partners");$("#dock-container, .dock-nav").css("bottom","0px");b();d3.selectAll(".country-labels").moveToFront();r()}if($(this).attr("id")==="trends"){$("#map").addClass("trends");$("#trends-switch").addClass("active");L();T();N();r()}if($(this).attr("id")==="stories"){$("#map").addClass("stories");M(stories);y.scale(1.6);y.translate([-329.3719199725873,-286.364649413111]);m.transition().duration(1e3).attr("transform","translate(-329.3719199725873,-286.364649413111)scale(1.6)");m.selectAll("path").attr("d",path.projection(projection))}}else{if($(this).attr("id")==="partners"){s();b();$("#map").addClass("partners");$("#dock-container, .dock-nav").css("bottom","0px")}}});var i='<p><span class="i r" id="data-notes-close">&#10060;</span><strong>Data Notes</strong></p>                <p>This map identifies all of the public private partnerships in health and water sanitation sectors that appear in the USAID Public-Private Partnerships Database. This database was sent to The GroundTruth Project by USAID on August 11, 2014. Since then, the data has been made publicly available on the <a href="http://www.usaid.gov/data" target="_blank">USAID data portal</a>. We chose to include the water sanitation projects in this map because of the direct link to public health issues; the <a href="http://www.who.int/water_sanitation_health/publications/Water_Safety_in_Distribution_System/en/" target="_blank">World Health Organization</a> links poor water quality to &ldquo;a significant proportion of the burden of waterborne and water-related illness.&ldquo; </p>                <p>We used USAID&rsquo;s definition of a public-private partnership: &ldquo;For the purposes of this dataset a Public-Private Partnership is defined as a USAID-supported development project or initiative which engages the private sector (including global and local businesses, foundations, industry associations, and others) as a core resource partner. This definition of PPPs differs from other ways of engaging the private sector such as contracting a for-profit implementer, in that this definition of PPPs requires private sector actors to be co-investing skills, technologies, other core business capabilities, or financial resources to the project or activity to achieve development outcomes.&ldquo;</p>                <p>In USAID&rsquo;s data notes, the agency also states: &ldquo;This dataset should be considered a broad-based and representative view of the PPPs USAID has developed from 2001-2013, but not a fully comprehensive or exhaustive compilation over this entire time period.&ldquo;</p>                <p>US Government Investment refers to the total value of resources invested in the partnership by the United States Government. Non-US Government Investment refers to the total value of resources (both cash and in-kind) invested in the partnership by all partners, both public and private, other than the United States Government.</p>                <p>Please note that this data does not identify the amount that each individual partner has given to each partnership.</p>                <p>Highlighted on this map are all of the private companies in USAID&rsquo;s database (in the health and water sanitation sectors) that are also identified by Fortune Magazine as US <a href="http://fortune.com/fortune500/wal-mart-stores-inc-1/" target="_blank">2014 Fortune 500 companies</a>. Thirty-eight of the 1,214 unique partners that engage in global health and water sanitation partnerships with USAID, according to the database shared with The GroundTruth Project, are also Fortune 500 companies.</p>                <p>For all corporations with associated foundations also participating in partnerships, their project totals have been included in the corporation&rsquo;s total project count. This includes: Abbott Laboratories (Abbott Fund), Bristol-Myers Squibb (Bristol-Myers Squibb Foundation), Citigroup (Citi Foundation), ExxonMobil (ExxonMobil Foundation), McDonald&rsquo;s (Ronald McDonald Foundation), Monsanto (Monsanto Fund), Nike (Nike Foundation), The Coca-Cola Company (Coca-Cola Foundation). Separate private and family foundations, including the Bill and Melinda Gates Foundation and the William and Flora Hewlett Foundation, were not included in this count.</p>                <p>The total number of partnerships in each country includes multi-country partnerships with that country specified. The total number of partnerships in each country does not include any global or regional partnerships where individual countries were not specified in the database.</p>                <p>&ldquo;Total Investment&ldquo; refers to USAID&rsquo;s term, &ldquo;Total Lifetime Investment.&ldquo; These budget totals for each region include the budgets of multi-country partnerships that work within one region, but do not include global or multi-regional projects. Global projects are highlighted separately in the sidebar. All regions shown are the official categories determined by USAID. </p>                <p>In order to calculate per capita investment for each country, we divided the total amount spent by <a href="http://data.worldbank.org/indicator/SP.POP.TOTL" target="_blank">national population</a>. Additionally, all regional totals shown in the sidebar have been rounded to the closest million. </p>                <p>Some of the partnership descriptions have been condensed for clarity and due to space constraints of the map.</p>';$("#data-notes").html(i);$("#data-notes-button").on("click",function(){$("#data-notes").toggleClass("active")});$(document.body).on("click","#data-notes-close",function(){$("#data-notes").removeClass("active")});o();$("#reset").on("click",function(){s();o()});$("#explore").on("click",function(){$("body").removeClass("intro");$("#info").css("left","0");$(".view").css("top","0");$("#intro").fadeOut(400);$("#partners").addClass("current");$("#map").addClass("partners");$("#dock-container, .dock-nav").css("bottom","0px");$("#data-notes-button, #reset").addClass("partners");b();$("#bsm").attr("class","active partners")});for(d=0;d<companies.length;d++){var u=document.createElement("li");u.className="corp";u.id=companies[d].corpid;u.style.backgroundImage="url(assets/dock_logos/"+companies[d].dockLogo+")";e.appendChild(u)}var a=d3.scale.sqrt().domain([0,20]).range([0,20]);var f=d3.scale.sqrt().domain([0,1338590149]).range([0,60]);var l=d3.scale.sqrt().domain([0,422474413]).range([0,60]);var h=d3.scale.sqrt().domain([0,917473590]).range([0,60]);var p=1100,v=550;projection=d3.geo.robinson().scale(200).translate([425,370]).precision(.1);path=d3.geo.path().projection(projection);svg=d3.select("#map").append("svg").attr("width",p).attr("height",v);var m=svg.append("g");queue().defer(d3.json,"../data/countries.json").defer(d3.json,"../data/land.json").defer(d3.json,"../data/world.json").await(g);var y=d3.behavior.zoom().on("zoom",function(){if(y.scale()>=.95){m.attr("transform","translate("+d3.event.translate.join(",")+")scale("+d3.event.scale+")");m.selectAll("path").attr("d",path.projection(projection))}else{y.scale(.95)}});svg.call(y);$(document.body).on("mouseover",".partners-list li",function(){$(this).addClass("highlight");var e=$(this).attr("data-target");for(c=0;c<companies.length;c++){var t=companies[c]["corpid"];if(e===t){$(this).css("background-color","#"+companies[c].hex);for(var n=0;n<companies[c]["countries"].length;n++){var r=companies[c]["countries"][n];if(r!="LAC (Continent)"&&r!="global"){$("#"+r).attr("style","fill:"+companies[c]["hex"]);$("#"+r+"-label").attr("class","country-label active")}}}}});$(document.body).on("mouseout",".partners-list li",function(){$(this).removeClass("highlight");$(this).css("background-color","transparent");w();$("#partners-back").removeClass("active")});$("#partners-back").on("click",function(){$("#partners-back").removeClass("active");w();b()});$(document.body).on("click",".corp, .partners-list li",function(){var e=$(this).attr("id");E($(this),e)});$(document.body).on("click",".project-title",function(){if(!$(this).parent().hasClass("active")){$(".world").attr("class","world");$(".country-label.active.highlight").attr("class","country-label active");$(".project").removeClass("active");$(this).parent().addClass("active");$(".country").attr("class","country");var e=$(this).parent().attr("id");for(var t=0;t<projects.length;t++){if(e===projects[t].projID){for(c=0;c<projects[t].projCountries.length;c++){$("#"+projects[t].projCountries[c]).attr("class","country project-country");$("#"+projects[t].projCountries[c]+"-label").attr("class","country-label active highlight")}}}if($(this).hasClass("global")){S()}}else{$(".country").attr("class","country");$(this).parent().removeClass("active");$(".country-label.active.highlight").attr("class","country-label active");x()}});$("#dock-left").on("click",function(){var e=$("#dock-container").width()/2;$("#corporate-dock").animate({scrollLeft:"-="+e},500)});$("#dock-right").on("click",function(){var e=$("#dock-container").width()/2;$("#corporate-dock").animate({scrollLeft:"+="+e},500)});$(document.body).on("mouseover",".national-trends-list li",function(){var e=$(this).attr("data-country");$(".t-"+e).addClass("highlight");var t=$(this).attr("data-symbol");$("#"+t).attr("class","points highlight");var n=$(this).children(".national-trends-country").text();var r=$(this).attr("data-projects");var i=k(t);d3.select("#trend-tip").style("left",i.left+"px").style("bottom",i.bottom+"px").classed("hidden",false).select("#tip-inner").html('<p class="tip-title">'+n+'</p><p class="tip-notes">Partnerships: <strong>'+r+"</strong></p>")});$(document.body).on("mouseout",".national-trends-list li",function(){$(".national-trends-list li").removeClass("highlight");$(".points").attr("class","points");d3.select("#trend-tip").classed("hidden",true)});$(document.body).on("click","#myonoffswitch",function(){L();var e=$(this).prop("checked");$(".trend-info").removeClass("active");$(".switch").removeClass("active");if(!e){$(".switch.national").addClass("active");$(".national-trends-info").addClass("active");N()}else{$(".switch.regional").addClass("active");$(".regional-trends-info").addClass("active");C("Partnerships");O()}});$(document.body).on("click",".regional-trends-button",function(){if(!$(this).hasClass("active")){$(".regional-trends-button").removeClass("active");$(this).addClass("active");var e=$(this).attr("id");C(e);O()}});$(document.body).on("click",".country-story",function(){var e=$(this).attr("id");for(var t=0;t<stories.length;t++){if(e==stories[t].country){$(".story").removeClass("active");$("#story-"+e).addClass("active");$(".country-story").attr("class","country country-story");$(this).attr("class","country country-story active-country")}}});d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};d3.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;if(e){parentNode.insertBefore(this,e)}})}})